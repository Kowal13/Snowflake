USE ROLE ACCOUNTADMIN;

DROP ROLE IF EXISTS ANALYST_ROLE;
DROP ROLE IF EXISTS DEVELOPER_ROLE;
DROP ROLE IF EXISTS D_FULL;
DROP ROLE IF EXISTS D_USAGE;
DROP ROLE IF EXISTS S_FULL;
DROP ROLE IF EXISTS S_READ;
DROP ROLE IF EXISTS S_WRITE;
DROP ROLE IF EXISTS LOCAL_ADMIN_ROLE;

CREATE WAREHOUSE IF NOT EXISTS POC1_WH;

CREATE OR REPLACE DATABASE POC1;

CREATE OR REPLACE ROLE D_FULL;
CREATE OR REPLACE ROLE D_USAGE;
CREATE OR REPLACE ROLE S_FULL;
CREATE OR REPLACE ROLE S_WRITE;
CREATE OR REPLACE ROLE S_READ;

GRANT ROLE D_FULL TO ROLE SYSADMIN;
GRANT ROLE D_USAGE TO ROLE SYSADMIN;
GRANT ROLE S_FULL TO ROLE SYSADMIN;
GRANT ROLE S_WRITE TO ROLE SYSADMIN;
GRANT ROLE S_READ TO ROLE SYSADMIN;

GRANT USAGE ON DATABASE POC1 TO ROLE D_USAGE WITH GRANT OPTION;
GRANT USAGE, MODIFY, MONITOR, CREATE SCHEMA ON DATABASE POC1 TO ROLE D_FULL WITH GRANT OPTION;

GRANT MODIFY, MONITOR, USAGE, CREATE TABLE, CREATE EXTERNAL TABLE, CREATE VIEW, CREATE MATERIALIZED VIEW, CREATE MASKING POLICY, CREATE SEQUENCE, CREATE FUNCTION, CREATE PROCEDURE, CREATE FILE FORMAT, CREATE STAGE, CREATE PIPE, CREATE STREAM, CREATE TASK
ON FUTURE SCHEMAS IN DATABASE POC1 TO ROLE S_FULL WITH GRANT OPTION;

GRANT SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES
ON FUTURE TABLES IN DATABASE POC1 TO ROLE S_FULL WITH GRANT OPTION;


GRANT SELECT ON FUTURE EXTERNAL TABLES IN DATABASE POC1 TO ROLE S_FULL WITH GRANT OPTION;

GRANT SELECT ON FUTURE VIEWS IN DATABASE POC1 TO ROLE S_FULL WITH GRANT OPTION;

GRANT SELECT ON FUTURE MATERIALIZED VIEWS IN DATABASE POC1 TO ROLE S_FULL WITH GRANT OPTION;

GRANT SELECT ON FUTURE STREAMS IN DATABASE POC1 TO ROLE S_FULL WITH GRANT OPTION;

GRANT USAGE ON FUTURE FUNCTIONS IN DATABASE POC1 TO ROLE S_FULL WITH GRANT OPTION;


GRANT USAGE ON FUTURE PROCEDURES IN DATABASE POC1 TO ROLE S_FULL WITH GRANT OPTION;


GRANT USAGE ON FUTURE FILE FORMATS IN DATABASE POC1 TO ROLE S_FULL WITH GRANT OPTION;


GRANT USAGE, READ, WRITE ON FUTURE STAGES IN DATABASE POC1 TO ROLE S_FULL WITH GRANT OPTION;


GRANT USAGE ON FUTURE SEQUENCES IN DATABASE POC1 TO ROLE S_FULL WITH GRANT OPTION;

--------------------------------------------------

GRANT MODIFY, MONITOR, USAGE, CREATE TABLE, CREATE EXTERNAL TABLE, CREATE VIEW, CREATE MATERIALIZED VIEW, CREATE SEQUENCE, CREATE FUNCTION, CREATE PROCEDURE, CREATE FILE FORMAT
ON FUTURE SCHEMAS IN DATABASE POC1 TO ROLE S_WRITE WITH GRANT OPTION;

GRANT SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES
ON FUTURE TABLES IN DATABASE POC1 TO ROLE S_WRITE WITH GRANT OPTION;

GRANT SELECT
ON FUTURE EXTERNAL TABLES IN DATABASE POC1 TO ROLE S_WRITE WITH GRANT OPTION;

GRANT SELECT
ON FUTURE VIEWS IN DATABASE POC1 TO ROLE S_WRITE WITH GRANT OPTION;

GRANT SELECT
ON FUTURE MATERIALIZED VIEWS IN DATABASE POC1 TO ROLE S_WRITE WITH GRANT OPTION;

GRANT SELECT
ON FUTURE STREAMS IN DATABASE POC1 TO ROLE S_WRITE WITH GRANT OPTION;

GRANT USAGE
ON FUTURE FUNCTIONS IN DATABASE POC1 TO ROLE S_WRITE WITH GRANT OPTION;

GRANT USAGE
ON FUTURE PROCEDURES IN DATABASE POC1 TO ROLE S_WRITE WITH GRANT OPTION;

GRANT USAGE
ON FUTURE FILE FORMATS IN DATABASE POC1 TO ROLE S_WRITE WITH GRANT OPTION;

GRANT USAGE
ON FUTURE STAGES IN DATABASE POC1 TO ROLE S_WRITE WITH GRANT OPTION;

GRANT USAGE
ON FUTURE SEQUENCES IN DATABASE POC1 TO ROLE S_WRITE WITH GRANT OPTION;

------------------------------------------------------

GRANT USAGE
ON FUTURE SCHEMAS IN DATABASE POC1 TO ROLE S_READ WITH GRANT OPTION;

GRANT SELECT, REFERENCES
ON FUTURE TABLES IN DATABASE POC1 TO ROLE S_READ WITH GRANT OPTION;

GRANT SELECT
ON FUTURE EXTERNAL TABLES IN DATABASE POC1 TO ROLE S_READ WITH GRANT OPTION;

GRANT SELECT
ON FUTURE VIEWS IN DATABASE POC1 TO ROLE S_READ WITH GRANT OPTION;

GRANT SELECT
ON FUTURE MATERIALIZED VIEWS IN DATABASE POC1 TO ROLE S_READ WITH GRANT OPTION;

GRANT SELECT
ON FUTURE STREAMS IN DATABASE POC1 TO ROLE S_READ WITH GRANT OPTION;

GRANT USAGE
ON FUTURE FUNCTIONS IN DATABASE POC1 TO ROLE S_READ WITH GRANT OPTION;

GRANT USAGE
ON FUTURE PROCEDURES IN DATABASE POC1 TO ROLE S_READ WITH GRANT OPTION ;

GRANT USAGE
ON FUTURE FILE FORMATS IN DATABASE POC1 TO ROLE S_READ WITH GRANT OPTION;

GRANT USAGE, READ, WRITE
ON FUTURE STAGES IN DATABASE POC1 TO ROLE S_READ WITH GRANT OPTION;

GRANT USAGE
ON FUTURE SEQUENCES IN DATABASE POC1 TO ROLE S_READ WITH GRANT OPTION;

-------------------------------------------------
GRANT ROLE S_FULL TO ROLE D_FULL;
GRANT OWNERSHIP ON ROLE S_FULL TO ROLE D_FULL REVOKE CURRENT GRANTS;
--------------------------------------------------

CREATE OR REPLACE SCHEMA SCHEMA1
WITH MANAGED ACCESS;
CREATE OR REPLACE SCHEMA SCHEMA2
WITH MANAGED ACCESS;
CREATE OR REPLACE SCHEMA SCHEMA3
WITH MANAGED ACCESS;

-- GRANT USAGE ON SCHEMA POC1.schema1 TO ROLE S_FULL;
-- GRANT USAGE ON SCHEMA POC1.schema2 TO ROLE S_FULL;
-- GRANT USAGE ON SCHEMA POC1.schema3 TO ROLE S_FULL;

-- GRANT USAGE ON SCHEMA POC1.schema1 TO ROLE S_WRITE;
-- GRANT USAGE ON SCHEMA POC1.schema2 TO ROLE S_WRITE;
-- GRANT USAGE ON SCHEMA POC1.schema3 TO ROLE S_WRITE;

-- GRANT USAGE ON SCHEMA POC1.schema1 TO ROLE S_READ;
-- GRANT USAGE ON SCHEMA POC1.schema2 TO ROLE S_READ;
-- GRANT USAGE ON SCHEMA POC1.schema3 TO ROLE S_READ;
--------------------------


CREATE OR REPLACE ROLE LOCAL_ADMIN_ROLE;
GRANT USAGE ON WAREHOUSE POC1_WH TO ROLE LOCAL_ADMIN_ROLE WITH GRANT OPTION;

GRANT ROLE D_FULL TO ROLE LOCAL_ADMIN_ROLE;
GRANT CREATE USER, CREATE ROLE ON ACCOUNT TO ROLE LOCAL_ADMIN_ROLE;

GRANT ROLE LOCAL_ADMIN_ROLE TO ROLE SYSADMIN;
GRANT OWNERSHIP ON ROLE D_USAGE TO ROLE LOCAL_ADMIN_ROLE REVOKE CURRENT GRANTS;
GRANT OWNERSHIP ON ROLE D_FULL TO ROLE LOCAL_ADMIN_ROLE REVOKE CURRENT GRANTS;
GRANT OWNERSHIP ON ROLE S_WRITE TO ROLE LOCAL_ADMIN_ROLE REVOKE CURRENT GRANTS;
GRANT OWNERSHIP ON ROLE S_READ TO ROLE LOCAL_ADMIN_ROLE REVOKE CURRENT GRANTS;

GRANT ALL ON SCHEMA SCHEMA1 TO ROLE LOCAL_ADMIN_ROLE;
GRANT ALL ON SCHEMA SCHEMA2 TO ROLE LOCAL_ADMIN_ROLE;
GRANT ALL ON SCHEMA SCHEMA3 TO ROLE LOCAL_ADMIN_ROLE;
--------------------
USE ROLE LOCAL_ADMIN_ROLE;

SHOW SCHEMAS;

USE ROLE ACCOUNTADMIN;
CREATE ROLE IF NOT EXISTS DEVELOPER_ROLE;
GRANT USAGE ON WAREHOUSE POC1_WH TO ROLE DEVELOPER_ROLE;

GRANT ROLE D_USAGE, S_WRITE TO ROLE DEVELOPER_ROLE;

CREATE ROLE ANALYST_ROLE;
GRANT ROLE D_USAGE, S_READ TO ROLE ANALYST_ROLE;

---------------------------------------------------

CREATE OR REPLACE USER DEVELOPER
DEFAULT_ROLE = "DEVELOPER_ROLE"
default_warehouse = "POC1_WH"
PASSWORD="abc123";
GRANT ROLE DEVELOPER_ROLE TO USER DEVELOPER;